<script src="lib/sweet-alert.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/sweet-alert.css">

{{#unless owner}}
  {{#if session.currentUser }}
    <form method="post" action="/fork">
      <input type="hidden" class='js-id' value="{{gist.id}}" name="id">
      <input type="hidden" value="{{filename}}" name="filename">
      <button type="submit">Fork</button>
    </form>
  {{/if}}
{{/unless}}

<form action="/update" method="post" class='js-submit'>
  <input class='col6 js-description' type='text' name='description' value='{{gist.description}}' placeholder="Enter Description...">
  <div class='row3 clearfix'>
    <input type="hidden" value="{{filename}}" name="oldFilename">
    <input class='js-filename filename col7 margin1r' type="text" value="{{filename}}" name="filename">
    <input type="hidden" class="js-id" value="{{gist.id}}" name="id">
  </div>
  {{#if owner}}
    <div class='js-by meta'>
	by {{gist.owner.login}} &nbsp;| 
    <small class="">
      {{#if gist.public}}
	 Public 
      {{else}}
	<span class='public-private'><span class="icon lock"></span></span>Private
      {{/if}}
      &nbsp;| <span class='icon duplicate'></span>Forks: {{gist.forks.length}} &nbsp;| <span class='icon history'></span>Revisions: {{gist.history.length}}
    </small>
    </div>
  {{/if}}
  <br><br>
  {{#if renderMarkdown}}
    <div class='file col8 js-render-markdown rendered-markdown'>{{content}}</div>
  {{else}}
    <textarea id='content' class='file col8 js-content' filename="{{filename}}" name="content" style='display:none'>{{content}}</textarea>
  {{/if}}
</form>
{{#if session.accessToken}}
  <nav class='pin-bottom margin-auto col7 ta-center'>
    <div class='pill bottom1 fr'>
       <a href='#' type='submit' data-submit="form.js-do-delete" class='small-50 btn btn-main btn-delete js-delete'>Delete</a><!--
       --><a href='#' type='submit' data-saved="true" data-submit="form.js-submit" class='small-50 btn btn-main js-save js-show-progress'>Save</a>
    </div>
    <div class='pill bottom1 fl'>
       <a class='btn' href='/'>Your gists</a><!--
        --><a class='btn' href='/new'>New gist</a>
    </div>
    <div class='pill bottom1'>
        <a class='btn' href='https://github.com/gistalt/gistalt/issues/new'>Submit feedback</a><!--
        --><a class='btn' href='/logout'>Logout</a><!--
       --><a class='btn' href='{{gist.html_url}}'>View on GitHub</a>
    </div>
  </nav>
{{else}}
  <nav class='pin-bottom margin-auto col7'>
    <div class='pill bottom1 fr'>
      <a class='btn-main btn' href='/login'>Log In with GitHub</a>
    </div>
  </nav>
  <script src='/js/marked.js'></script>
  <script type='text/javascript'>
  window.onload = function(){
    $.getJSON('https://api.github.com/gists/{{gist.id}}', function( res ){
      var content = res.files["{{filename}}"].content
      $('textarea').html( content )
      $('.js-by').html( "by "+ res.owner.login )
      gistalt.els.description.value = res.description
      var toRender = document.querySelector('.js-render-markdown')
      toRender.innerHTML = marked( content ) 
    })
  }

  </script>
{{/if}}

<form method="post" action="/delete" class='js-do-delete'>
  <input type="hidden" value="{{gist.id}}" name="id">
</form>
